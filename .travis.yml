language: node_js
os: linux
dist: xenial
node_js: [14]

cache:
  npm: true
  directories:
    - $HOME/.cache

addons:
  apt:
    packages:
      # Ubuntu 16+ does not install this dependency by default, so we need to install it ourselves
      - libgconf-2-4

install:
  - npm install

script:
  - npm run build
  - npm run lint --no-fix
  - npm run test

deploy:
  - provider: script
    skip_cleanup: true
    script: npm run chromatic
    on:
      all_branches: true
      condition: $TRAVIS_BRANCH != "main"
  - provider: script
    skip_cleanup: true
    script: npm run chromatic -- --auto-accept-changes
    on:
      branch: main
  - provider: script
    skip_cleanup: true
    script:
      - npx semantic-release -b main
    on:
      branch: main
