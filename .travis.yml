language: node_js
os: linux
dist: xenial
node_js: [14]

cache:
  npm: true
  directories:
    - $HOME/.cache

addons:
  apt:
    packages:
      # Ubuntu 16+ does not install this dependency by default, so we need to install it ourselves
      - libgconf-2-4

install:
  - yarn install

script:
  - yarn run ci

deploy:
  - provider: script
    skip_cleanup: true
    script: yarn run chromatic && yarn run test:publish
    on:
      all_branches: true
      condition: $TRAVIS_BRANCH != "main"
  - provider: script
    skip_cleanup: true
    script: yarn run chromatic --auto-accept-changes
    on:
      branch: main
  - provider: script
    skip_cleanup: true
    script:
      - yarn run semantic-release
    on:
      branch: main
