<template>
  <div class="details-panel-header">
    <div class="details-panel-header__parents" v-if="parents.length">
      <div
        class="details-panel-header__parent"
        v-for="(item, index) in parents"
        :key="index"
        @click="selectObject(item)"
      >
        <div class="details-panel-header__parent-icon">
          <svg
            v-if="item.type === 'package'"
            viewBox="0 0 512 512"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m511.9 126.269c-.598-5.507-4.02-10.381-9.135-12.768l-240-112c-4.289-2.001-9.243-2.001-13.532 0l-240 112c-5.114 2.387-8.536 7.26-9.135 12.768-.013.115-.098 1.647-.098 1.731v272c0 6.542 3.983 12.426 10.058 14.855l240 96c1.907.763 3.925 1.145 5.942 1.145s4.035-.381 5.942-1.145l240-96c6.075-2.429 10.058-8.313 10.058-14.855v-272c0-.084-.087-1.617-.1-1.731zm-255.9-92.613 199.744 93.214-76.914 30.766-203.503-86.332zm-119.69 55.856 200.346 84.993-80.656 32.262-199.744-79.897zm-104.31 62.12 208 83.2v237.535l-208-83.2zm240 320.736v-237.536l208-83.2v237.535z"
            />
          </svg>
          <svg
            v-if="item.type === 'class'"
            viewBox="-32 0 384 384"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m304 384c8.832031 0 16-7.167969 16-16v-272c0-4.238281-1.6875-8.3125-4.6875-11.3125l-80-80c-3-3-7.074219-4.6875-11.3125-4.6875h-208c-8.832031 0-16 7.167969-16 16v352c0 8.832031 7.167969 16 16 16zm-272-352h185.375l70.625 70.625v249.375h-256zm0 0"
            />
            <path
              d="m240 112h-160c-8.832031 0-16 7.167969-16 16v64c0 8.832031 7.167969 16 16 16h160c8.832031 0 16-7.167969 16-16v-64c0-8.832031-7.167969-16-16-16zm-16 64h-128v-32h128zm0 0"
            />
            <path
              d="m80 264h96c8.832031 0 16-7.167969 16-16s-7.167969-16-16-16h-96c-8.832031 0-16 7.167969-16 16s7.167969 16 16 16zm0 0"
            />
            <path
              d="m224 288h-144c-8.832031 0-16 7.167969-16 16s7.167969 16 16 16h144c8.832031 0 16-7.167969 16-16s-7.167969-16-16-16zm0 0"
            />
          </svg>
          <svg
            v-if="item.type === 'function'"
            viewBox="0 0 512 512"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m448 182.059v-98.059c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971l47.03 47.029-47.029 47.029c-4.501 4.501-7.03 10.606-7.03 16.971v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.373-9.373 9.373-24.568 0-33.941z"
            />
            <path
              d="m64 428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36v-108c0-6.365-2.529-12.47-7.029-16.971l-47.03-47.029 47.029-47.029c4.501-4.501 7.03-10.606 7.03-16.971v-108c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941l56.971 56.971z"
            />
          </svg>
          <svg
            v-if="item.type === 'route'"
            viewBox="0 0 512 512"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="m437.02 74.98c-48.353-48.351-112.64-74.98-181.02-74.98s-132.667 26.629-181.02 74.98c-48.351 48.353-74.98 112.64-74.98 181.02s26.629 132.667 74.98 181.02c48.353 48.351 112.64 74.98 181.02 74.98s132.667-26.629 181.02-74.98c48.351-48.353 74.98-112.64 74.98-181.02s-26.629-132.667-74.98-181.02zm25.883 89.804h-44.077c-6.411-22.048-26.569-38.29-50.541-38.791-13.791-35.82-32.88-65.835-56.459-89.078 39.01 9.868 74.786 30.084 103.98 59.279 20.106 20.106 35.953 43.335 47.097 68.59zm19.097 91.216c0 20.99-2.849 41.54-8.351 61.216h-87.032c4.659-28.928 6.016-59.049 3.89-88.95 13.611-6.584 24.033-18.74 28.319-33.482h54.823c5.502 19.676 8.351 40.226 8.351 61.216zm-403.488 61.216h-40.161c-5.502-19.676-8.351-40.226-8.351-61.216s2.849-41.54 8.351-61.216h87.063c-3.952 24.52-5.548 49.922-4.646 75.291-20.877 7.593-36.933 25.287-42.256 47.141zm288.636-113.612c-13.134 0-23.82-10.686-23.82-23.82s10.686-23.819 23.82-23.819c13.135 0 23.82 10.686 23.82 23.819.001 13.135-10.685 23.82-23.82 23.82zm-51.676-38.82h-44.472v-123.225c34.766 25.017 55.72 61.168 68.134 92.291-11.319 6.928-19.879 17.924-23.662 30.934zm-74.472-123.18v123.18h-78.474c3.34-12.164 7.356-23.907 12.027-35.069 15.877-37.949 38.594-67.96 66.447-88.111zm0 153.18v122.432h-32.297c-6.601-27.101-29.715-47.803-58.043-50.781-.692-24.238 1.078-48.435 5.157-71.651zm-97.393 101.278c20.406 0 37.007 16.602 37.007 37.007s-16.601 37.007-37.007 37.007c-20.405 0-37.006-16.602-37.006-37.007s16.601-37.007 37.006-37.007zm65.491 51.154h31.902v123.366c-26.495-18.789-47.591-45.599-62.979-80.045 15.624-9.392 27.116-24.97 31.077-43.321zm61.902 123.201v-123.201h78.485c-2.789 10.14-6.046 20.005-9.777 29.503-15.961 40.633-39.461 72.566-68.708 93.698zm0-153.201v-122.432h44.471c5.938 20.424 23.67 35.865 45.305 38.43 1.795 28.352.213 56.824-4.564 84.001h-85.212zm-174.806-221.022c29.229-29.23 65.057-49.462 104.121-59.316-21.827 21.541-39.913 48.933-53.437 81.258-6.171 14.749-11.295 30.401-15.34 46.648h-82.441c11.144-25.255 26.991-48.484 47.097-68.59zm-47.097 251.022h29.02c6.513 30.174 33.396 52.859 65.49 52.859 1.929 0 3.833-.101 5.721-.261 12.953 29.919 29.75 55.012 50.228 75.108-38.769-9.924-74.323-30.077-103.363-59.117-20.105-20.105-35.952-43.334-47.096-68.589zm366.709 68.59c-29.221 29.221-65.036 49.45-104.088 59.307 23.202-22.891 42.145-52.375 55.913-87.426 5.086-12.947 9.38-26.497 12.864-40.472h82.408c-11.144 25.256-26.991 48.485-47.097 68.591z"
            />
          </svg>
        </div>
        {{ item.name }}
      </div>
    </div>
    <h4 class="details-panel-header__details-type">{{ objectType }}</h4>
    <h4 class="details-panel-header__details-name" :if="title">{{ title }}</h4>
    <div class="details-panel-header__ghost-link">
      <slot name="links" />
    </div>
  </div>
</template>

<script>
import { SELECT_OBJECT } from '@/store/vsCode';

export default {
  name: 'v-details-panel-header',

  props: {
    objectType: {
      type: String,
      required: true,
    },
    object: {
      type: Object,
    },
    title: {
      type: String,
    },
  },

  computed: {
    parents() {
      let result = [];

      if (this.object) {
        if (this.object.event && this.object.codeObject) {
          result = [
            this.object.codeObject,
            ...this.object.codeObject.ancestors(),
          ];
        } else {
          result = [...this.object.ancestors()];
        }
      }

      return result.reverse();
    },
  },

  methods: {
    selectObject(obj) {
      if (this.$store) {
        this.$store.commit(SELECT_OBJECT, obj);
      }
    },
  },
};
</script>

<style scoped lang="scss">
.details-panel-header {
  margin: 1rem 0;
  padding: 0 2rem 1rem 2rem;
  border-bottom: 1px solid $base15;

  &__parents {
    margin-bottom: 1rem;
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    flex-wrap: wrap;
  }

  &__parent {
    position: relative;
    margin: 0 1rem 0.5rem 0;
    border-radius: $border-radius;
    padding: 0.3rem 0.5rem;
    display: inline-flex;
    align-items: center;
    background: $blue;
    cursor: pointer;

    &:hover,
    &:active {
      background: $lightblue;
    }

    &::after {
      content: '‚ùØ';
      position: absolute;
      top: 50%;
      left: 100%;
      margin-left: 4px;
      transform: translateY(-50%);
      font-size: 0.6rem;
      pointer-events: none;
    }

    &-icon {
      margin-right: 0.5rem;
      width: 1rem;
      height: 1rem;
      min-width: 1rem;
      min-height: 1rem;

      &:empty {
        display: none;
      }

      svg {
        fill: currentColor;
      }
    }
  }

  &__details-type {
    color: $gray4;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 0;
    font-size: 0.9rem;
    font-weight: 500;
    margin: 0 0 0.2rem;
  }

  &__details-name {
    color: $base03;
    letter-spacing: 0.5px;
    border-bottom: 0;
    font-size: 1.5rem;
    font-weight: 500;
    margin-bottom: 0.8rem;
    margin-top: 0;
  }
}
</style>
